<!DOCTYPE html>  <html> <head>   <title>account_activate.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="account_activate.html">                 account_activate.coffee               </a>                                           <a class="source" href="account_home.html">                 account_home.coffee               </a>                                           <a class="source" href="account_register.html">                 account_register.coffee               </a>                                           <a class="source" href="app_fetch.html">                 app_fetch.coffee               </a>                                           <a class="source" href="command.html">                 command.coffee               </a>                                           <a class="source" href="config_list.html">                 config_list.coffee               </a>                                           <a class="source" href="hello_world.html">                 hello_world.coffee               </a>                                           <a class="source" href="puppy.html">                 puppy.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               account_activate.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Import necessary Node.js libraries.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">path = </span><span class="nx">require</span> <span class="s2">&quot;path&quot;</span>
<span class="nv">fs = </span><span class="nx">require</span> <span class="s2">&quot;fs&quot;</span>
<span class="nv">spawn = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;child_process&quot;</span><span class="p">).</span><span class="nx">spawn</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Import necessary Puppy libraries.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Configuration = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./puppy&quot;</span><span class="p">).</span><span class="nx">Configuration</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Command Implementation</h3>

<p>The <code>account:activate</code> command is invoked by a new registrant after they've
recieved their registration code via email.</p>

<pre><code>$ puppy account:regsiter 2c0aa17f0d39731b6276d1cd78500d2b
</code></pre>

<hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The JavaScript dispatch program slices <code>argv</code> to the first command line
argument and passes it in as <code>args</code>. </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">module.exports.command = </span><span class="nf">(args) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Load the user configuration, set defaults.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">configuration = </span><span class="k">new</span> <span class="nx">Configuration</span><span class="p">()</span>

  <span class="nv">server = </span><span class="nx">configuration</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">)</span> <span class="o">or</span> <span class="s2">&quot;portoroz.prettyrobots.com&quot;</span>

  <span class="k">delete</span> <span class="nx">configuration</span><span class="p">.</span><span class="nx">local</span><span class="p">[</span><span class="s2">&quot;home&quot;</span><span class="p">]</span>
  <span class="k">delete</span> <span class="nx">configuration</span><span class="p">.</span><span class="nx">global</span><span class="p">[</span><span class="s2">&quot;home&quot;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Request the host server for the account. Then invoke the account
registration command on the host server via SSH using the user's default
identity. That is, the identities provided by the SSH configuration or the
SSH agent, and not a specific identity.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">configuration</span><span class="p">.</span><span class="nx">home</span> <span class="nf">(home, user) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">[</span> <span class="nx">home</span><span class="p">,</span> <span class="nx">user</span> <span class="p">]</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span> <span class="mi">1</span>
    <span class="p">[</span> <span class="nx">code</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">args</span>

    <span class="nv">stdout = </span><span class="s2">&quot;&quot;</span>
    <span class="nv">ssh = </span><span class="nx">spawn</span> <span class="s2">&quot;ssh&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="s2">&quot;-T&quot;</span><span class="p">,</span> <span class="nx">home</span><span class="p">,</span> <span class="s2">&quot;/usr/bin/sudo&quot;</span><span class="p">,</span> <span class="s2">&quot;-u&quot;</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="s2">&quot;/puppy/bin/account_activate&quot;</span> <span class="p">]</span>
    <span class="nx">ssh</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span>
    <span class="nx">ssh</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="kc">on</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="nf">(chunk) -&gt;</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ssh</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="kc">on</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="nf">(chunk) -&gt;</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="nx">ssh</span><span class="p">.</span><span class="kc">on</span> <span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="nf">(code) -&gt;</span>
      <span class="k">if</span> <span class="nx">code</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s2">&quot;Activation successful. Welcome to Puppy.\n&quot;</span>
      <span class="k">else</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s2">&quot;Unable to activate.\n&quot;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 